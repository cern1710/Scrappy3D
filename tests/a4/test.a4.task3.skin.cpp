#include "test.h"
#include "geometry/util.h"
#include "scene/skeleton.h"

std::optional<std::pair<std::string, size_t>> compareVerts(std::vector<Indexed_Mesh::Vert> expected,
                                                           std::vector<Indexed_Mesh::Vert> actual) {
    if (expected.size() != actual.size()) {
		return std::pair{"expected.size() != actual.size()", 0};
	}

	for (int32_t i = 0; i < (int32_t)expected.size(); i++) {
		if (Test::differs(expected[i].pos, actual[i].pos)) {
			return std::pair{"Vertex positions differ", i};
		}
		if(Test::differs(expected[i].norm, actual[i].norm)) {
				return std::pair{"Vertex normals differ", i};
		}
	}

	return std::nullopt;
}

Test test_a4_task3_skin_cylinder_root("a4.task3.skin.cylinder.root", []() {
	Indexed_Mesh capsule = Util::cyl_mesh(0.5f, 4);
    Halfedge_Mesh mesh = Halfedge_Mesh::from_indexed_mesh(capsule);
	Skeleton skeleton;
	auto root = skeleton.add_bone(-1U, Vec3(0.0f, 1.0f, 0.0f));
    skeleton.bones[root].radius = 0.6f;
	auto child1 = skeleton.add_bone(root, Vec3(0.0f, 1.5f, 0.0f));
    skeleton.bones[child1].radius = 0.6f;
	auto child2 = skeleton.add_bone(child1, Vec3(0.0f, 1.5f, 0.0f));
    skeleton.bones[child2].radius = 0.6f;

	std::vector<Indexed_Mesh::Vert> expected_vertices;
    skeleton.bones[root].pose = Vec3(0.0f, 0.0f, 30.0f);
    auto bind = skeleton.bind_pose();
    auto current = skeleton.current_pose();
    skeleton.assign_bone_weights(&mesh);
	auto actual = skeleton.skin(mesh, bind, current);

	std::string test_case = "Testing on the root bone...";
    expected_vertices = {{Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 26},
                        {Vec3(0.433013f, 0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 26},
                        {Vec3(0.375000f, 0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 26},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 33},
                        {Vec3(0.375000f, 0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 33},
                        {Vec3(0.216506f, 0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 33},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 39},
                        {Vec3(0.216506f, 0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 39},
                        {Vec3(-0.000000f, -0.000000f, 0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 39},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 45},
                        {Vec3(-0.000000f, -0.000000f, 0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 45},
                        {Vec3(-0.216506f, -0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 45},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 51},
                        {Vec3(-0.216506f, -0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 51},
                        {Vec3(-0.375000f, -0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 51},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 57},
                        {Vec3(-0.375000f, -0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 57},
                        {Vec3(-0.433013f, -0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 57},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 63},
                        {Vec3(-0.433013f, -0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 63},
                        {Vec3(-0.375000f, -0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 63},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 69},
                        {Vec3(-0.375000f, -0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 69},
                        {Vec3(-0.216506f, -0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 69},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 75},
                        {Vec3(-0.216506f, -0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 75},
                        {Vec3(-0.000000f, -0.000000f, -0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 75},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 81},
                        {Vec3(-0.000000f, -0.000000f, -0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 81},
                        {Vec3(0.216506f, 0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 81},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 87},
                        {Vec3(0.216506f, 0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 87},
                        {Vec3(0.375000f, 0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 87},
                        {Vec3(0.000000f, 0.000000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 93},
                        {Vec3(0.375000f, 0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 93},
                        {Vec3(0.433013f, 0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 93},
                        {Vec3(-1.625000f, 3.680608f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 98},
                        {Vec3(-1.566987f, 3.714102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 98},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 98},
                        {Vec3(-1.783494f, 3.589102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 105},
                        {Vec3(-1.625000f, 3.680608f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 105},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 105},
                        {Vec3(-2.000000f, 3.464102f, 0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 111},
                        {Vec3(-1.783494f, 3.589102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 111},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 111},
                        {Vec3(-2.216506f, 3.339102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 117},
                        {Vec3(-2.000000f, 3.464102f, 0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 117},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 117},
                        {Vec3(-2.375000f, 3.247595f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 123},
                        {Vec3(-2.216506f, 3.339102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 123},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 123},
                        {Vec3(-2.433013f, 3.214102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 129},
                        {Vec3(-2.375000f, 3.247595f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 129},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 129},
                        {Vec3(-2.375000f, 3.247595f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 135},
                        {Vec3(-2.433013f, 3.214102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 135},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 135},
                        {Vec3(-2.216506f, 3.339102f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 141},
                        {Vec3(-2.375000f, 3.247595f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 141},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 141},
                        {Vec3(-2.000000f, 3.464102f, -0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 147},
                        {Vec3(-2.216506f, 3.339102f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 147},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 147},
                        {Vec3(-1.783494f, 3.589101f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 153},
                        {Vec3(-2.000000f, 3.464102f, -0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 153},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 153},
                        {Vec3(-1.625000f, 3.680608f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 159},
                        {Vec3(-1.783494f, 3.589101f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 159},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 159},
                        {Vec3(-1.566987f, 3.714102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 165},
                        {Vec3(-1.625000f, 3.680608f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 165},
                        {Vec3(-2.000000f, 3.464102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 165},
                        {Vec3(-1.625000f, 3.680608f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 170},
                        {Vec3(0.433013f, 0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 170},
                        {Vec3(-1.566987f, 3.714102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 170},
                        {Vec3(-1.625000f, 3.680608f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 176},
                        {Vec3(0.375000f, 0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 176},
                        {Vec3(0.433013f, 0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 176},
                        {Vec3(-1.783494f, 3.589102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 181},
                        {Vec3(0.375000f, 0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 181},
                        {Vec3(-1.625000f, 3.680608f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 181},
                        {Vec3(-1.783494f, 3.589102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 186},
                        {Vec3(0.216506f, 0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 186},
                        {Vec3(0.375000f, 0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 186},
                        {Vec3(-2.000000f, 3.464102f, 0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 191},
                        {Vec3(0.216506f, 0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 191},
                        {Vec3(-1.783494f, 3.589102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 191},
                        {Vec3(-2.000000f, 3.464102f, 0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 196},
                        {Vec3(-0.000000f, -0.000000f, 0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 196},
                        {Vec3(0.216506f, 0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 196},
                        {Vec3(-2.216506f, 3.339102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 201},
                        {Vec3(-0.000000f, -0.000000f, 0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 201},
                        {Vec3(-2.000000f, 3.464102f, 0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 201},
                        {Vec3(-2.216506f, 3.339102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 206},
                        {Vec3(-0.216506f, -0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 206},
                        {Vec3(-0.000000f, -0.000000f, 0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 206},
                        {Vec3(-2.375000f, 3.247595f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 211},
                        {Vec3(-0.216506f, -0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 211},
                        {Vec3(-2.216506f, 3.339102f, 0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 211},
                        {Vec3(-2.375000f, 3.247595f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 216},
                        {Vec3(-0.375000f, -0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 216},
                        {Vec3(-0.216506f, -0.125000f, 0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 216},
                        {Vec3(-2.433013f, 3.214102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 221},
                        {Vec3(-0.375000f, -0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 221},
                        {Vec3(-2.375000f, 3.247595f, 0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 221},
                        {Vec3(-2.433013f, 3.214102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 226},
                        {Vec3(-0.433013f, -0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 226},
                        {Vec3(-0.375000f, -0.216506f, 0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 226},
                        {Vec3(-2.375000f, 3.247595f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 231},
                        {Vec3(-0.433013f, -0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 231},
                        {Vec3(-2.433013f, 3.214102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 231},
                        {Vec3(-2.375000f, 3.247595f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 236},
                        {Vec3(-0.375000f, -0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 236},
                        {Vec3(-0.433013f, -0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 236},
                        {Vec3(-2.216506f, 3.339102f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 241},
                        {Vec3(-0.375000f, -0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 241},
                        {Vec3(-2.375000f, 3.247595f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 241},
                        {Vec3(-2.216506f, 3.339102f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 246},
                        {Vec3(-0.216506f, -0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 246},
                        {Vec3(-0.375000f, -0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 246},
                        {Vec3(-2.000000f, 3.464102f, -0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 251},
                        {Vec3(-0.216506f, -0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 251},
                        {Vec3(-2.216506f, 3.339102f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 251},
                        {Vec3(-2.000000f, 3.464102f, -0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 256},
                        {Vec3(-0.000000f, -0.000000f, -0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 256},
                        {Vec3(-0.216506f, -0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 256},
                        {Vec3(-1.783494f, 3.589101f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 261},
                        {Vec3(-0.000000f, -0.000000f, -0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 261},
                        {Vec3(-2.000000f, 3.464102f, -0.500000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 261},
                        {Vec3(-1.783494f, 3.589101f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 266},
                        {Vec3(0.216506f, 0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 266},
                        {Vec3(-0.000000f, -0.000000f, -0.500000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 266},
                        {Vec3(-1.625000f, 3.680608f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 271},
                        {Vec3(0.216506f, 0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 271},
                        {Vec3(-1.783494f, 3.589101f, -0.433013f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 271},
                        {Vec3(-1.625000f, 3.680608f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 276},
                        {Vec3(0.375000f, 0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 276},
                        {Vec3(0.216506f, 0.125000f, -0.433013f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 276},
                        {Vec3(-1.566987f, 3.714102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 281},
                        {Vec3(0.375000f, 0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 281},
                        {Vec3(-1.625000f, 3.680608f, -0.250000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 281},
                        {Vec3(-1.566987f, 3.714102f, 0.000000f), Vec3(-0.500000f, 0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 286},
                        {Vec3(0.433013f, 0.250000f, 0.000000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 286},
                        {Vec3(0.375000f, 0.216506f, -0.250000f), Vec3(0.500000f, -0.866025f, 0.000000f), Vec2(0.000000f, 0.000000f), 286}};
	if (auto diff = compareVerts(expected_vertices, actual.vertices())) {
		throw Test::error(test_case + "Test failed: " + diff.value().first + " at vertex " +
		                  std::to_string(diff.value().second));
	}
});
